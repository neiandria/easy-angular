<div class="p-6 bg-gray-50 min-h-screen">
  <div class="max-w-2xl mx-auto bg-white rounded-xl shadow p-6">
    <h2 class="text-2xl font-bold text-blue-800 mb-4">
      Agendar Nova Consulta
      <span *ngIf="selectedPaciente" class="text-base text-gray-600">- {{ selectedPaciente.nome }}</span>
    </h2>

    <!-- Wizard Steps Indicator -->
    <div class="flex items-center mb-6">
      <ng-container *ngFor="let lbl of getStepLabels(); let i = index">
        <div class="flex-1 text-center">
          <div
            class="mx-auto w-8 h-8 rounded-full flex items-center justify-center mb-1"
            [ngClass]="step === i+1 ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600'">
            {{ i+1 }}
          </div>
          <div class="text-sm" [ngClass]="step === i+1 ? 'text-blue-600' : 'text-gray-500'">
            {{ lbl }}
          </div>
        </div>
      </ng-container>
    </div>

    <ng-container [ngSwitch]="step">
      <!-- Step 1: Paciente -->
      <div *ngSwitchCase="1">
        <label class="block mb-2 font-medium text-gray-700">Paciente</label>
        <select [(ngModel)]="selectedPaciente" class="w-full border rounded p-2 mb-4">
          <option [ngValue]="null" disabled selected>-- Selecione --</option>
          <option *ngFor="let p of pacientes" [ngValue]="p">{{ p.nome }}</option>
        </select>
        <div class="flex justify-end">
          <button
            (click)="nextStep()"
            [disabled]="!selectedPaciente"
            class="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50">
            Próximo
          </button>
        </div>
      </div>

      <!-- Step 2: Especialidade -->
      <div *ngSwitchCase="2">
        <label class="block mb-2 font-medium text-gray-700">Especialidade</label>
        <select
          [(ngModel)]="selectedSpecialty"
          (change)="onSelectSpecialty()"
          class="w-full border rounded p-2 mb-4">
          <option [ngValue]="null" disabled selected>-- Selecione --</option>
          <option *ngFor="let esp of specialties" [ngValue]="esp">{{ esp }}</option>
        </select>
        <div class="flex justify-between">
          <button (click)="prevStep()" class="bg-gray-300 px-4 py-2 rounded">Voltar</button>
          <button
            (click)="nextStep()"
            [disabled]="!selectedSpecialty"
            class="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50">
            Próximo
          </button>
        </div>
      </div>

      <!-- Step 3: Médico -->
      <div *ngSwitchCase="3">
        <label class="block mb-2 font-medium text-gray-700">Médico</label>
        <select
          [(ngModel)]="selectedDoctorId"
          class="w-full border rounded p-2 mb-4">
          <option [ngValue]="null" disabled selected>-- Selecione --</option>
          <option *ngFor="let d of doctors" [ngValue]="d.id_medico">{{ d.nome }}</option>
        </select>
        <div class="flex justify-between">
          <button (click)="prevStep()" class="bg-gray-300 px-4 py-2 rounded">Voltar</button>
          <button
            (click)="nextStep()"
            [disabled]="!selectedDoctorId"
            class="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50">
            Próximo
          </button>
        </div>
      </div>

      <!-- Step 4: Data -->
      <div *ngSwitchCase="4">
        <label class="block mb-2 font-medium text-gray-700">Data</label>
        <div class="grid grid-cols-7 text-sm text-gray-500 mb-2">
          <div *ngFor="let wd of weekDays">{{ wd }}</div>
        </div>
        <div class="grid grid-cols-7 mb-4">
          <button
            *ngFor="let day of calendarDays"
            (click)="selectDate(day.date)"
            [disabled]="!day.currentMonth"
            class="w-8 h-8 m-0.5 rounded-full transition"
            [ngClass]="{
              'bg-blue-600 text-white': isSelected(day.date),
              'hover:bg-blue-100': day.currentMonth && !isSelected(day.date),
              'text-gray-400': !day.currentMonth
            }">
            {{ day.date.getDate() }}
          </button>
        </div>
        <div class="flex justify-between mb-4">
          <button (click)="prevMonth()" class="bg-gray-300 px-4 py-2 rounded">&lt; Mês Ant.</button>
          <button (click)="nextMonth()" class="bg-gray-300 px-4 py-2 rounded">Próx. Mês &gt;</button>
        </div>
        <div class="flex justify-between">
          <button (click)="prevStep()" class="bg-gray-300 px-4 py-2 rounded">Voltar</button>
          <button
            (click)="nextStep()"
            [disabled]="!selectedDate"
            class="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50">
            Próximo
          </button>
        </div>
      </div>

      <!-- Step 5: Horário -->
      <div *ngSwitchCase="5">
        <label class="block mb-2 font-medium text-gray-700">Horário</label>
        <div class="grid grid-cols-3 gap-2 mb-4">
          <button
            *ngFor="let t of times"
            (click)="selectTime(t)"
            [disabled]="!isTimeAvailable(t)"
            class="py-2 rounded-lg transition"
            [ngClass]="{
              'bg-blue-600 text-white': t===selectedTime,
              'bg-gray-100 hover:bg-blue-100': isTimeAvailable(t) && t!==selectedTime,
              'bg-gray-200 text-gray-400 cursor-not-allowed': !isTimeAvailable(t)
            }">
            {{ t }}
          </button>
        </div>
        <div class="flex justify-between">
          <button (click)="prevStep()" class="bg-gray-300 px-4 py-2 rounded">Voltar</button>
          <button
            (click)="nextStep()"
            [disabled]="!selectedTime"
            class="bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50">
            Próximo
          </button>
        </div>
      </div>

      <!-- Step 6: Resumo -->
      <div *ngSwitchCase="6">
        <h3 class="font-semibold mb-4">Resumo</h3>
        <p><strong>Paciente:</strong> {{ selectedPaciente.nome }}</p>
        <p><strong>Especialidade:</strong> {{ selectedSpecialty }}</p>
        <p><strong>Dr(a).:</strong> {{ getDoctorName() }}</p>
        <p><strong>Data:</strong> {{ selectedDate | date:'dd/MM/yyyy' }}</p>
        <p><strong>Horário:</strong> {{ selectedTime }}</p>
        <div class="flex justify-between mt-4">
          <button (click)="prevStep()" class="bg-gray-300 px-4 py-2 rounded">Voltar</button>
          <button
            (click)="confirmarAgendamento()"
            class="bg-green-600 text-white px-4 py-2 rounded">
            Confirmar
          </button>
        </div>
      </div>
    </ng-container>

    <!-- Mensagem de sucesso -->
    <div *ngIf="showConfirmation" class="mt-6 bg-green-100 border border-green-300 text-green-800 p-4 rounded text-center">
      <p class="font-semibold mb-2">Consulta agendada com sucesso!</p>
      <button
        (click)="voltarDashboard()"
        class="bg-blue-600 text-white px-4 py-2 rounded">
        OK
      </button>
    </div>
  </div>
</div>
